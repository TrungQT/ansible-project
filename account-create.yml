- name: Create local admin user on Windows
  hosts: vision_servers
  gather_facts: true
  vars:
    windows_domain: "{{ ansible_hostname }}"  # ðŸ‘ˆ use NetBIOS hostname here
  tasks:

    - name: Create a local user
      ansible.windows.win_user:
        name: svc-vision-account
        password: "Str0ngP@ssw0rd2025!"
        password_never_expires: true
        user_cannot_change_password: true
        account_disabled: false

    - name: Add user to Administrators group (correct format)
      ansible.windows.win_group_membership:
        name: Administrators
        members:
          - '{{ windows_domain }}\svc-vision-account'  # ðŸ‘ˆ now resolves correctly
        state: present